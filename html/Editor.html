<!-- <?php
session_start();

if(isset($_SESSION['id']) OR isset($_COOKIE['id'])){
  include('DBconnection.php');
  $html = $_POST['html'] ;
  $css = $_POST['css'];
  $javascript =$_POST['javascript'];
  if(isset($_POST['save-code'])){
    if(!empty($html)){
        $query = 'UPDATE `users details` SET `HTML`="'.$html.'" WHERE `id`="'.$_SESSION['id'].'"';
        $result= mysqli_query($connection, $query);
        if(!$result){
          echo "fail";
        }
    }
  }  

}


?> -->

<!DOCTYPE html>
<html>
  <head>
    <title>Web Compiler</title>
    <link rel="stylesheet" href="../css/Editor.css" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script
      src="https://kit.fontawesome.com/0000f17b81.js"
      crossorigin="anonymous"
    ></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav>
      <div class="logo-container">
        <h3>Code-Blocks</h3>
      </div>
      <div class="toggle-panel-wrapper">
        <ul class="nav-links">
          <div class="nav-link active" onclick="togglePanel(this)" id="Html">
            HTML
          </div>
          <div class="nav-link" onclick="togglePanel(this)" id="Css">CSS</div>
          <div class="nav-link" onclick="togglePanel(this)" id="Js">
            JAVASCRIPT
          </div>
          <div class="nav-link" onclick="togglePanel(this)" id="Output">
            OUTPUT
          </div>
        </ul>
      </div>

      <div class="menu-button">
        <button id="menu-button">
          <i class="fas fa-bars fa-lg" style="margin-right: 3px"></i>Menu
        </button>
        <div class="menu-button-dropdown">
          <button id="save-code-btn" name="save-code">Save Code</button>
          <a href="logout.php">Logout</a>
        </div>
      </div>
    </nav>

    <main>
      <form action="" method="post">
        <div id="bodyContainer">
          <div class="Panels" id="HtmlPanel">
            <textarea
              id="html"
              name="html"
              placeholder=" ENTER HTML CODE HERE"
            ></textarea>
          </div>
          <div class="Panels hidden" id="CssPanel">
            <textarea
              id="css"
              name="css"
              placeholder=" ENTER CSS CODE HERE"
            ></textarea>
          </div>
          <div class="Panels hidden" id="JsPanel">
            <textarea
              id="js"
              name="js"
              placeholder=" ENTER JAVASCRIPT HERE"
            ></textarea>
          </div>
          <iframe class="Panels" id="OutputPanel" placeholder="Output"></iframe>
        </div>
      </form>
    </main>

    <script type="text/javascript">
      function togglePanel(x) {
        var PanelName = x.id + "Panel";
        x.classList.toggle("active");
        var mainPanel = document.getElementById(PanelName);
        mainPanel.classList.toggle("hidden");
      }

      function compile() {
        var html = document.getElementById("html");
        var css = document.getElementById("css");
        var js = document.getElementById("js");
        var code = document.getElementById("OutputPanel").contentWindow
          .document;

        document.body.onkeyup = function () {
          code.open();
          code.writeln(
            html.value +
              "<style>" +
              css.value +
              "</style>" +
              "<script>" +
              js.value +
              "<\/script>"
          );
          code.close();
        };
      }

      compile();

      document.getELementById("save-code-btn").addEventListener("click", () => {
        var xhttp = new XMLHttpRequest();

        xhttp.open("POST", "SaveCode.php", true);
        xhttp.send();
      });
    </script>
  </body>
</html>
